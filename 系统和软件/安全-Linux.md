# Linux安全

*   linux系统架构
    *   用户间，内核态与用户态之间隔离
    *   用户进程一般低权限运行
    *   系统服务一般特权权限运行
    *   用户态通过系统调用进去内核态
    *   内核对系统资源调度

*   常见攻击

    *   远程网络攻击
        *   用户仿冒攻击：伪造ID，暴力破解
        *   网络DDos攻击
        *   网络服务/进程攻击

    *   本地远程攻击
        *   内核攻击
        *   系统服务攻击
        *   业务进程攻击

    *   近端物理攻击
        *   镜像篡改攻击：加载固件替换篡改
        *   物理端口攻击：物理端口绕过登陆

*   攻击步骤
    *   踩点：信息搜集，端口扫描
        *   解决：屏蔽系统敏感信息不暴露
    *   扫描：漏洞扫描，已知漏洞，弱配置，弱密码
        *   解决：关闭非必要端口，对网络进行隔离，使用安全协议，系统漏洞防御，最小化安装，保持系统更新，认证与鉴权
    *   攻击：暴力破解，定向挖掘漏洞
        *   解决：文件访问控制，最小化授权，应用隔离
    *   提权：利用系统弱点进行提权
        *   解决：安全维护
    *   清除日志植入后门：篡改日志隐匿行踪，植入木马持续控制
*   防御系统信息泄露
    *   问题
        *   网络服务暴露系统详细信息
        *   网络协议暴露系统信息
        *   配置文件默认提供内核版本，可进行版本漏洞查找
        *   通过google，shodan获取信息
        *   内核接口泄漏地址布局等信息
        *   通过ICMP报文获取子网信息，目标系统时间戳
        *   查看内核导出接口内核地址布局，令KASLR失效
    *   解决
        *   通过banner隐藏系统信息
        *   防止普通用户通过dmesg、串口打印等绕过内核地址随机化
        *   使用sysctl设置kernel.kptr_restrict=1，禁止低权限用户查看内核打印地址

*   远程攻击

    *   每一个端口都是攻击入口：
        *   通过netstat，lsof等查看监听端口合理性，iptables对不对外暴露端口过滤

    -   网络隔离：
        -   系统链接多网段，进行网段隔离，减小攻击面
        -   不对外端口监听本地127.0.0.1，不监听所有0.0.0.0
        -   第三方组件监听端口使用iptables过滤

    -   安全协议

    -   栈保护：
        -   栈溢出漏洞覆盖函数返回地址，以控制程序执行流
        -   gcc使用-fstack-protector-strong选项
        -   缓冲区buffer与控制信息RBP间插入canary字段，判断canary是否修改进行判断

    -   地址随机化：

        -   用户态地址随机化ASLR
            -   sysctl设置kernel.randomize_va_space=2
            -    gcc加入-fPIE-pie

        *   内核地址对计划KASLR

    -   系统漏洞防御机制：NX（DEP），ROP（代码重用：越狱常用手段）

    -   最小化安装：不安装冗余软件，防止打开新端口，增加攻击面

    *   开发调试工具：gcc，gdb，objdump，strace，内核源码，ko编译

    -   网络嗅探工具：tcpdump，tshark，wireshark

    -   禁止root远程登录：

    -   鉴权：PAM模块

*   本地攻击：文件访问控制
    *   DAC自主访问控制-属主可操作
    *   分区挂载安全
    *   文件访问权限
    *   设置UMASK权限掩码
    *   避免设置setuid权限位：具有setuid位的文件运行时权限为owner
    *   全局可写目录风险
        *   qq设置目录黏滞位
        *   软连接保护
        *   硬连接保护
        *   独立分区

    *   MAC强制访问控制：root可操作
        *   MAC不是替换DAC，而是增加控制

    *   最小授权
        *   避免root运行程序
        *   通过capability授权，内核提供38种权限，特权分离

    *   安全维护：日志审计
        *   系统日志syslog系统信息
        *   内核审计audit系统调用
        *   日志保护：服务器储存，设置轮转，设施沦陷